# Vitamix Gemini Worker Configuration
name = "vitamix-gemini"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# ============================================
# REQUIRED SETUP BEFORE DEPLOYMENT
# ============================================
# 1. Set API secrets (configure the providers you want to use):
#    wrangler secret put ANTHROPIC_API_KEY  # For Claude models
#    wrangler secret put CEREBRAS_API_KEY   # For Cerebras models
#    wrangler secret put GOOGLE_API_KEY     # For Gemini models
#
# 2. Set DA (Document Authoring) S2S credentials (preferred):
#    wrangler secret put DA_CLIENT_ID
#    wrangler secret put DA_CLIENT_SECRET
#    wrangler secret put DA_SERVICE_TOKEN
#
#    OR use legacy static token (fallback):
#    wrangler secret put DA_TOKEN
#
# 3. Create KV namespace (if not exists):
#    wrangler kv:namespace create SESSIONS
#    Then update the id below with the returned ID
#
# 4. Create Vectorize index (if not exists):
#    wrangler vectorize create vitamix-content --dimensions=768 --metric=cosine
# ============================================

# Environment variables (secrets should be set via wrangler secret)
[vars]
MODEL_PRESET = "production"  # Options: production, fast, all-cerebras, gemini-production, gemini-3-all, gemini-2.5-all, gemini-mixed
GEMINI_MODEL_VERSION = "gemini-3-flash-preview"  # For Gemini presets: gemini-3-flash-preview or gemini-2.5-flash
DEBUG = "false"
# DA (Document Authoring) configuration
DA_ORG = "paolomoz"
DA_REPO = "vitamix-poc"

# Workers AI for embeddings
[ai]
binding = "AI"

# Vectorize for semantic search (create with: wrangler vectorize create vitamix-content --dimensions=768 --metric=cosine)
[[vectorize]]
binding = "VECTORIZE"
index_name = "vitamix-content"

# KV for session persistence (create with: wrangler kv:namespace create SESSIONS)
[[kv_namespaces]]
binding = "SESSIONS"
id = "f941193db7084d9582f7f2db2ae8c0dc"

# Development settings
[dev]
port = 8787
local_protocol = "http"

# Production environment
[env.production]
name = "vitamix-gemini"

[env.production.vars]
MODEL_PRESET = "production"  # Claude Opus + Cerebras - balanced quality/speed
GEMINI_MODEL_VERSION = "gemini-3-flash-preview"
DEBUG = "false"
DA_ORG = "paolomoz"
DA_REPO = "vitamix-poc"

# Staging environment
[env.staging]
name = "vitamix-gemini-staging"

[env.staging.vars]
MODEL_PRESET = "fast"  # Claude Sonnet + Cerebras - faster response
GEMINI_MODEL_VERSION = "gemini-3-flash-preview"
DEBUG = "true"
DA_ORG = "paolomoz"
DA_REPO = "vitamix-poc"
